<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<title>Config</title>
<script>
var HttpClient = function() {
    this.get = function(aUrl, aCallback) {
        var anHttpRequest = new XMLHttpRequest();
        anHttpRequest.onreadystatechange = function() { 
            if (anHttpRequest.readyState == 4 && anHttpRequest.status == 200)
                aCallback(anHttpRequest.responseText);
        }

        anHttpRequest.open( "GET", aUrl, true );            
        anHttpRequest.send( null );
    }
		
		this.post = function(aUrl, data, aCallback) {
        var anHttpRequest = new XMLHttpRequest();
        anHttpRequest.onreadystatechange = function() { 
            if (anHttpRequest.readyState == 4 && anHttpRequest.status == 200)
                aCallback(anHttpRequest.responseText);
        }

        anHttpRequest.open("POST", aUrl, true);	
				anHttpRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
				anHttpRequest.send(data);
    }
}

var client = new HttpClient();

function UpdateConfig(){
	var myJSON = {"I2CDeveice":2,"STASsid":"TienHuy","STAPass":"012345689"};				
	var table = document.getElementById('TableConfig');
	myJSON.I2CDeveice = Number(table.rows[0].cells[1].children[0].value);
	myJSON.DisTo = Number(table.rows[1].cells[1].children[0].value);
	if(myJSON.DisTo<100) myJSON.DisTo=100;
	myJSON.STASsid = table.rows[2].cells[1].children[0].value;
	myJSON.STAPass = table.rows[3].cells[1].children[0].value;
	var StrJSON = JSON.stringify(myJSON);
	client.post('/postdata', "Config=" + StrJSON, function(response) {	
    console.log(response);
  });
}

function onBodyLoad(){			
	client.get('/config.txt', function(response) {	
    console.log(response);
		var obj = JSON.parse(response);
		var table = document.getElementById('TableConfig');
		var rows = table.getElementsByTagName('tr');
		table.rows[0].cells[1].children[0].value = obj.I2CDeveice;
		table.rows[1].cells[1].children[0].value = obj.DisTo;
		table.rows[2].cells[1].children[0].value = obj.STASsid;
		table.rows[3].cells[1].children[0].value = obj.STAPass;
  });
}
</script>
<style>
div,input{padding:5px;font-size:1em;} 
input{width:100%;} 
body{text-align: center;font-family:verdana;} 
button{border:0;border-radius:0.3rem;background-color:#4CAF50;color:#fff;line-height:2.4rem;font-size:1.2rem;width:100%;} 
</style>
</head>
<body style="" onload="onBodyLoad()">
<div style="text-align:left;display:inline-block;min-width:260px;">
<br><br><br><br><br>
<button>Cài đặt thông số board</button>
<table id="TableConfig" width="100%">
<tr>
<td align="left">I2CDeveice</td>
<td><input type="text" value="0"></td>
</tr>
<tr>
<td align="left">DisTo</td>
<td><input type="text" value="0"></td>
</tr>
<tr>
<td align="left">STASsid</td>
<td><input type="text" value="0"></td>
</tr>
<tr>
<td align="left">STAPass</td>
<td><input type="text" value="0"></td>
</tr>
</table>
<br><input type="button" value="Save" onclick="UpdateConfig()">
<br><div align="center"><a href="./">Home</a></div>
</div>
</body>
</html>